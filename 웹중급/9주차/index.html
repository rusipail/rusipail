<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        #container{
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #res{
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            flex-grow: 1;
        }

        #res > div{
            box-sizing: border-box;
            position: relative;
            flex-grow: 1;
            overflow: hidden;
        }

        #res > div::before{
            content:attr(data-num);
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
            color:white;
            font-size: 1.5vw;
            bottom:0;
            width: 100%;
            height: 50px;
            text-align: center;
        }

        #img-container{
            display: flex;
            justify-content: center;
        }

        button{
            padding: 0;
            font-size:50px;
            background-color: transparent;
            border:none;
        }

        #img-container > div{
            width: 80px;
            height: 80px;
            background-image: url("img/dice.png");
            background-repeat: no-repeat;
            background-size: auto 308%;
            background-position-y: center;
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="control-container">
            <button data-id="up">ğŸ”¼</button>
            <button data-id="down">ğŸ”½</button>
        </div>
        <div id="img-container"></div>
        <div id="res"></div>
    </div>
    <script>

        /*
            ì—¬ëŸ¬ ì£¼ì‚¬ìœ„ì˜ ê²½ìš°ì˜ ìˆ˜ë¥¼ í™•ì¸í•´ë³´ì.
            ì£¼ì‚¬ìœ„ë¥¼ ëŒë¦¬ë©´ì„œ ê³„ì† ê²½ìš°ì˜ ìˆ˜ê°€ ë‚˜ì˜¤ë„ë¡ í•œë‹¤.
            buttonì€ 6ê°€ì§€ì´ë‹¤.
                - up : ì£¼ì‚¬ìœ„ ê°¯ìˆ˜ë¥¼ ëŠ˜ë¦°ë‹¤. ì´ ê²½ìš° ê·¸ë˜í”„ì™€ ì£¼ì‚¬ìœ„ëˆˆì€ ëª¨ë‘ ì´ˆê¸°í™”ëœë‹¤. ê°¯ìˆ˜ëŠ” 10ê°œê¹Œì§€ì´ë‹¤.
                - down : ì£¼ì‚¬ìœ„ ê°¯ìˆ˜ë¥¼ ì¤„ì¸ë‹¤. ìŒìˆ˜ëŠ” ë  ìˆ˜ ì—†ë‹¤.
        */

        const imgContainer = document.querySelector('#img-container');
        const controlContainer = document.querySelector('#control-container');
        const res = document.querySelector('#res');
        
        const dices = [];

        const graph = {
            max:0,
            bars:[]
        };

        const update = () => {
            res.innerHTML = '';
            graph.bars = {};
            graph.max = 0;
            for(let i = dices.length; i <= dices.length * 6; i++){
                const div = document.createElement('div');
                let M = Math.floor(Math.random() * 256)
                let N = Math.floor(Math.random() * 256)
                let B = Math.floor(Math.random() * 256)
                div.style.backgroundColor = `rgb(${M}, ${N}, ${B})`;
                div.style.height = '50px'
                let num = i
                graph.bars.key = i;
                graph.bars.value = {div, num}
                div.dataset.num = num;
                res.appendChild(div)
                // ìƒ‰ì€ ëœë¤í•˜ê²Œ
                // bars ì—ëŠ” keyê°€ i, valueëŠ” {div, num} ì´ ìˆë„ë¡ í•œë‹¤.
                // divëŠ” íƒœê·¸, numì€ ë‚˜ì˜¨ íšŸìˆ˜ì´ë‹¤.
            }
        };

        // diceë¥¼ ì¶”ê°€í•œë‹¤.
        const addDice = () => {
            //if(dices.length > 10){
                const div = document.createElement('div');
                const obj = {
                    div,
                    num:0,
                };
                imgContainer.appendChild(div);
                dices.push(obj)
                update();
            //}
            
            // imgContainerì— ì¶”ê°€í•˜ëŠ” ì½”ë“œ
            // dicesì— ì¶”ê°€í•˜ëŠ” ì½”ë“œ
            
            
        };

        // diceë¥¼ ì œê±°í•œë‹¤.
        const deleteDice = () => {
            const div = document.querySelectorAll('#img-container > div')
            const i = div.length - 1;
            console.log(div)
            div[i].remove()
            console.log(div)
            dices.pop();
            
            for(let i = 0; i < dices.length; i++){
                addDice;
            }
            update()
            // dicesì—ì„œ ì œê±°í•˜ëŠ” ì½”ë“œ
            // imgContainerì—ì„œ ì œê±°í•˜ëŠ” ì½”ë“œ
        };

        const render = () => {
            if(dices.length){
                let total = 0;
                for(let i of dices){
                    i.num = Math.floor(Math.random() * 6);
                    i.num += 1;
                    i.div.style.backgroundPositionX = `calc(100% / 5 * ${i.num})`;
                    total += i.num;

                }
                // dicesë¥¼ ìˆœíšŒí•˜ë©° diceì— ëœë¤í•œ ìˆ˜ë¥¼ ì…ë ¥í•˜ê³ , ê·¸ê²ƒì— ë”°ë¼ì„œ divì˜ backgroundImagePositionì„ ë°”ê¾¼ë‹¤.  
                
                // diceë¥¼ ë‚˜ì˜¨ ìˆ«ìì—ë”°ë¼ ì •ë ¬í•œë‹¤.
                
                // ì •ë ¬í•œ divë¡œ ë‹¤ì‹œ appendChild í•œë‹¤.(sort)ì‚¬ìš©

                // dice ëˆˆì˜ ìˆ«ìë¥¼ ë”í•œ ê°’ì„ barsì˜ total keyì™€ ê°™ì€ ê°’ì˜ ê°ì²´ë¥¼ ì°¾ì•„ numì„ 1 ì¦ê°€í•œë‹¤.

                // ë§Œì•½ ë°©ê¸ˆ ì¦ê°€í•œ ê°’ì´ graph.maxë³´ë‹¤ í¬ë©´ graph.maxë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

                // graph.bars ë¥¼ ìˆœíšŒí•˜ë©° ë†’ì´ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.

                // ë†’ì´ëŠ” (100% - 50px) * num / max + 50px ì´ë‹¤.
            }
            requestAnimationFrame(render);
        };

        controlContainer.onclick = e => {
            const tar = e.target;
            console.log(tar)
            if(tar.nodeName == 'BUTTON'){
                const { dataset } = tar;
                if(dataset.id == 'up'){
                    console.log('up')
                    addDice()
                } else if(dataset.id == 'down'){
                    console.log('down')
                    deleteDice()
                }
                // dataset.idì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ëŠ” ë²„íŠ¼
            }
        };

        render();
    </script>
</body>

</html>